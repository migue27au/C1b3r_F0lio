<!DOCTYPE html>
<html>
<head>
	<title>C1b3r_F0lio - Locker</title>

	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">

	<!-- Boostrap -->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
	
	<!-- footer -->
	<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
	<link rel="stylesheet" href="../css/footer.css">

	<!-- top button -->
	<link rel="stylesheet" href="../css/topbutton.css">

</head>
<body class="bg-dark">

	<header>
		<div> <!--navbar -->
			<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03" aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<a class="navbar-brand" href="../index.html">C1b3r_F0lio</a>

			<div class="collapse navbar-collapse" id="navbarTogglerDemo03">
				<ul class="navbar-nav mr-auto mt-2 mt-lg-0">
					<li class="nav-item">
						<a class="nav-link" href="../index.html">Home</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../challenges.html">Challenges</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../proyectos.html">Proyectos</a>
					</li>
					<li class="nav-item">
						<a class="nav-link" href="../logros.html">Logros</a>
					</li>
				</ul>
			</div>
		</nav>
		</div>
		<div> <!--background image -->
			<img src="../images/background.gif" class="img-fluid" alt="Responsive image">
		</div>
	</header>
	<br/>
	<main class="container bg-dark text-white">
		<div class="row">
            <div class="col col-10">
    		  <h1 class="display-4">HackMyVM - Locker</h1>
            </div>
            <div class="col col-2 d-flex flex-row-reverse">
                 <h5 class="text-secondary">17 octubre 2021</h5>
            </div>
		</div>

		<div class="row">
			<div class="col">
				<p>Esta máquina se encuentra en la plataforma <a href="https://hackmyvm.eu/">HackMyVM</a> y ha sido creada por el usuario <a href="https://twitter.com/x6cx61x63x61x73"><em>sml</em></a>.</p>
				<p>Una máquina sencilla con una vulnerabilidad RCE en la web PHP explotable para conseguir acceso y una escalada de privilegios directa entre www-data y root.</p>
			</div>
			<div class="col">
				<table class="table">
				  <thead>
				    <tr class="bg-secondary">
				      <th scope="col">#</th>
				      <th scope="col">Dificultad</th>
				    </tr>
				  </thead>
				  <tbody>
				    <tr>
				      <th scope="row">Acceso</th>
				      <td class="text-success">Muy Fácil</td>
				    </tr>
				    <tr>
				      <th scope="row">Escalada de privilegios</th>
				      <td class="text-success">Fácil</td>
				    </tr>
				  </tbody>
				</table>
			</div>
		</div>
		

		<hr>
		<h4 class="d-flex justify-content-center">Enumeración</h4>
		<hr>

		<p>La máquina objetivo y la máquina atacante se encuentran en la misma red, esto permite hallar la dirección IP de la máquina objetivo mediante un escaneo ARP con la herramienta arp-scan.</p>
		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/1.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>La herramienta ha detectado 3 IP:</p>
		<ul>
			<li>10.10.10.1 - Sagemcom Broadband → Gateway</li>
			<li>10.10.10.101 - PCS Systemtechnik → Máquina objetivo</li>
			<li>10.10.10.102 - GIGA-BYTE TECHNOLOGY → Sistema anfitrión</li>
		</ul>

		<p>Una vez identificada la máquina objetivo se comienza con el escaneo de puertos. Como es habitual para el escaneo se utiliza nmap y se divide en dos fases: la primera de un escaneo rápido de los 65535 puertos para detectar aquellos abiertos y la segunda para realizar una enumeración más exahustiva usando scripts básicos de los puertos abiertos.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/2.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<br />

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/3.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Únicamente se ha detectado el servicio HTTP en el puerto 80.</p>
		<p>Consultando la web mediante el navegador se encuentra la siguiente vista.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/4.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Al acceder al enlace aparece una imagen de un candado. Fijándose en la URL se observa un parámetro número que al modificarse cambia la imagen mostrada únicamente se encuentran tres imágenes.</p>
		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-center">
					<img loading="lazy" src="../images/challenges/locker/5.PNG" alt="error loading image :(" class="img-fluid">
				</div>
			</div>
			<div class="col">
				<div class="d-flex justify-content-center">
					<img loading="lazy" src="../images/challenges/locker/6.PNG" alt="error loading image :(" class="img-fluid">
				</div>
			</div>
			<div class="col">
				<div class="d-flex justify-content-center">
					<img loading="lazy" src="../images/challenges/locker/7.PNG" alt="error loading image :(" class="img-fluid">
				</div>
			</div>
		</div>

		<p>Que se puedan modificar las imágenes cambiando un parámetro de la URL da a pensar que sería posible un ataque LFI o RCE desde este campo de la URL. Tras probar varios payloads se encuentra uno que permite la ejecución remota de comandos: ; comando ;</p>
		
		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/9.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<hr>
		<h4 class="d-flex justify-content-center">Ganar acceso</h4>
		<hr>

		<p>Se ejecuta una reverse shell con netcat contra la máquina objetivo y se consigue acceso a la máquina como www-data.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/10.PNG" alt="error loading image :(" class="img-fluid">
		</div>
		<br/>
		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/11.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Tras un tratamiento de la TTY se obtiene una SHELL interactiva. Para saber como se realiza este tratamiento, la web <a href="https://www.thehackersnow.com/tratamiento-de-una-tty/">thehackersnow.com</a> tiene una guía muy detallada de como hacerlo.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/12.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Se consultan los permisos suid de www-data y se encuentra uno que nunca se había visto antes: /usr/sbin/sulogin</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/14.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Consultando el manual del binario se encuentra que ejecuta una shell como root a partir de la variable de entorno SUSHELL.</p>
		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/15.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<hr>
		<h4 class="d-flex justify-content-center">Escalada de privilegios</h4>
		<hr>

		<p>La escalada de privilegios consistirá en ejecutar una shell como root a partir del binario sulogin. En primer lugar se pruebó asignando un archivo con una /bin/bash a la variable de entorno SUSHELL pero no se tuvo éxito. Por esto, se prueba programando una shell muy simple en C para crear un binario y asignarlo a la variable de entorno.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/16.PNG" alt="error loading image :(" class="img-fluid">
		</div>
		
		<p>Se compila el binario y se ejecuta para comprobar que funciona correctamente.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/17.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Ahora será necesario descargarlo en el máquina objetivo. Para eso se utiliza un servicio HTTP a partir de python y descargar el binario en la máquina objetivo mediante wget.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/18.PNG" alt="error loading image :(" class="img-fluid">
		</div>
		<br/>
		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/19.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Finalmente, se modifica la variable de entorno, se dan permisos de dan permisos de ejecución al binario y se ejecuta el binario con la opción -e.</p>

		<div class="d-flex justify-content-center">
			<img loading="lazy" src="../images/challenges/locker/20.PNG" alt="error loading image :(" class="img-fluid">
		</div>

		<p>Con esto, ya se obtiene el root a la máquina y pueden consultarse la flags de user y root.</p>

		<div class="row">
			<div class="col">
				<div class="d-flex justify-content-center">
					<img loading="lazy" src="../images/challenges/locker/21.PNG" alt="error loading image :(" class="img-fluid">
				</div>
			</div>
			<div class="col">
				<div class="d-flex justify-content-center">
					<img loading="lazy" src="../images/challenges/locker/22.PNG" alt="error loading image :(" class="img-fluid">
				</div>
			</div>
		</div>


	</main>
	<br/>
	<footer class="container">
		<div class="row">
			<div class="col">
				<a href="../challenges.html"> ← Volver </a>
			</div>
			<div class="col">
				<div class="d-flex flex-row-reverse">
					<ul class="social-network social-circle"> <!-- thanks to https://codepen.io/NamiqNamaz/pen/QZYyEq --> 		<li>
							<a href="https://github.com/migue27au" class="icoGithub" title="Facebook"><i class="fa fa-github" style="color: white;"></i></a>
						</li>
						<li>
							<a href="https://www.linkedin.com/in/migue27au" class="icoLinkedin" title="Linkedin"><i class="fa fa-linkedin" style="color: white;"></i></a>
						</li>
					</ul>
				</div>
			</div>
		</div>
	</footer>


	<a id="topBtn" class="text-primary" onclick="toTop()"><i class="fa fa-angle-up fa-3x"></i></a>
	<script type="text/javascript">
		//Get the button:
		btn = document.getElementById("topBtn");

		// When the user scrolls down 20px from the top of the document, show the button
		window.onscroll = function() {scrollFunction()};
		function scrollFunction() {
			if (document.body.scrollTop > 700 || document.documentElement.scrollTop > 700) {
				btn.style.opacity = "1";
			} else {
				btn.style.opacity = "0";
			}
		}

		// When the user clicks on the button, scroll to the top of the document
		function toTop() {
			document.body.scrollTop = 0; // For Safari
			document.documentElement.scrollTop = 0; // For Chrome, Firefox, IE and Opera
		}
	</script>

</body>
</html>


	